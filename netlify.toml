[build]
  publish = "."
  functions = "netlify/functions"

# Deezer proxy — handles ARL cookie server-side, bypassing CORS.
[[redirects]]
  from = "/deezer-proxy"
  to = "/.netlify/functions/deezer-proxy"
  status = 200
  force = true

# Public config — exposes Spotify client ID and Last.fm API key to the frontend.
[[redirects]]
  from = "/api/config"
  to = "/.netlify/functions/config"
  status = 200
  force = true

# Last.fm auth — server-side token exchange, keeps Shared Secret off the client.
[[redirects]]
  from = "/api/lastfm-auth"
  to = "/.netlify/functions/lastfm-auth"
  status = 200
  force = true

# OAuth callback route — serves the SPA so popup/redirect callbacks are handled client-side.
# Query params (?code=, ?token=, ?error=) are preserved automatically by Netlify rewrites.
[[redirects]]
  from = "/callbacks"
  to = "/index.html"
  status = 200
  force = true
